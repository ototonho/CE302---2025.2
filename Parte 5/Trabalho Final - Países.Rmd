---
title: "Diagnóstico por país"
author: "Antonio Paulo Steffen Neto"
date: "2025-12-03"
output: html_document
---


# Trabalho Final


```{r}

require(tidyverse)
require(tidytuesdayR)


all_recipes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-16/all_recipes.csv')

cuisines <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-16/cuisines.csv')

```

```{r}
str(all_recipes)
str(cuisines)
```
```{r}
cuisines_limpo <- cuisines %>%
  mutate(
    country_padrao = case_when(
      country %in% c("Jewish") ~ "Israeli/Jewish",
      country %in% c("Cajun and Creole", "Southern Recipes", "Tex-Mex", "Southwestern Recipes", "Amish and Mennonite", "Soul Food") ~ "US American", 
      .default = country # Mantém o nome do país para todos os outros
    )
  )


table(cuisines_limpo$country)

```



```{r}
analise_por_pais <- cuisines_limpo %>%
  # Remove linhas onde a avaliação é NA
  filter(!is.na(avg_rating)) %>%
  group_by(country_padrao) %>%
  summarise(
    contagem_receitas = n(),
    media_rating = mean(avg_rating, na.rm = TRUE),
    # NOVO: Adiciona o Desvio Padrão
    desvio_padrao_rating = sd(avg_rating, na.rm = TRUE), 
    media_porcoes = mean(servings, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  # Opcional: Filtra países com poucas receitas para tornar a média mais robusta
  filter(contagem_receitas >= 10) %>%
  arrange(desc(media_rating))

# Exibe o resultado da análise
print(analise_por_pais)
```

```{r}
analise_por_continente <- analise_por_pais %>%
  mutate(
    continente = case_when(
      # === ASIA ===
      country_padrao %in% c("Japanese", "Indian", "Chinese", "Thai", "Filipino", "Vietnamese", "Korean", "Indonesian", "Turkish", "Malaysian", "Pakistani", "Iranian", "Israeli/Jewish", "Lebanese", "Syrian", "Yemeni", "Emirati", "Kuwaiti", "Omani", "Qatari", "Saudi Arabian", "Middle Eastern", "Persian", "Turkish", "Israeli", "Bangladeshi") ~ "Asian",
      
      # === EUROPA ===
      country_padrao %in% c("British", "French", "German", "Irish", "Italian", "Spanish", "Scandinavian Region", "Greek", "Swiss", "Dutch", "Austrian", "Portuguese", "Russian", "Belgian", "Hungarian", "Polish", "Czech", "Slovakian", "Romanian", "Ukrainian", "Scandinavian", "Finnish", "Swedish", "Norwegian", "Danish") ~ "European",
      
      # === AMÉRICA DO NORTE e CARIBE ===
      country_padrao %in% c("US American", "Canadian", "Mexican", "Caribbean Region", "Puerto Rican", "Cuban", "Jamaican", "Dominican", "Haitian", "Costa Rican", "Panamanian", "Honduran", "Guatemalan", "Salvadoran") ~ "North American",
      
      # === AMÉRICA DO SUL ===
      country_padrao %in% c("Chilean", "Brazilian", "Peruvian", "Argentinian", "Venezuelan", "Colombian", "Ecuadorian", "Bolivian", "Paraguayan", "Uruguayan") ~ "South American",
      
      # === ÁFRICA ===
      country_padrao %in% c("Moroccan", "Egyptian", "South African", "Ethiopian", "Kenyan", "Nigerian", "Algerian", "Tunisian", "Somali", "African") ~ "African",
      
      # === OCEANIA ===
      country_padrao %in% c("Australian and New Zealander", "Fijian", "Samoan") ~ "Oceania",
      
      # Países Transcontinentais/Culturais não classificados acima
      .default = "Outros" 
    )
  )

# Agrupamento FINAL revisado
analise_por_continente_agregado <- analise_por_continente %>%
  group_by(continente) %>%
  summarise(
    contagem_total = sum(contagem_receitas),
    # A Média da Média de Rating e a Média do Desvio Padrão
    media_rating_continente = mean(media_rating, na.rm = TRUE),
    desvio_padrao_continente = mean(desvio_padrao_rating, na.rm = TRUE), 
    .groups = 'drop'
  ) %>%
  arrange(desc(media_rating_continente))

# Visualizando a Nova Tabela Agregada
print(analise_por_continente_agregado)


```




```{r}
require(ggplot2)

grafico_colorido <- analise_por_continente %>%
  # Limita aos Top 15 países/regiões para visualização
  slice_max(media_rating, n = 15) %>% 
  
  # Estética principal, usando 'fill' para o continente
  ggplot(aes(x = reorder(country_padrao, media_rating), 
              y = media_rating, 
              fill = continente)) +
  
  # Adiciona as barras coloridas
  geom_col(alpha = 0.8) +
  
  # Adiciona as Barras de Erro (Desvio Padrão)
  geom_errorbar(aes(ymin = media_rating - desvio_padrao_rating, 
                    ymax = media_rating + desvio_padrao_rating,
                    color = continente), # Usa a cor do continente para o DP também
                width = 0.2) +
  
  # Escala de cores (opcional, mas recomendado para um visual mais bonito)
  scale_fill_brewer(palette = "Set2") +
  scale_color_manual(values = rep("black", 6)) + # Define as barras de erro em preto
  
  # Inverte os eixos para facilitar a leitura
  coord_flip() +
  
  # Títulos e Rótulos
  labs(
    title = "Top 15 Culinárias por Média de Avaliação (Coloridas por Continente)",
    subtitle = "Barras de erro representam o Desvio Padrão. Cores indicam o Continente.",
    x = "País/Região",
    y = "Média de Avaliação (1 a 5)",
    fill = "Continente" # Legenda da cor
  ) +
  
  # Remove a legenda de cor das barras de erro
  guides(color = "none") + 
  
  # Tema
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"))

print(grafico_colorido)
```



