---
title: "Trabalho Final - Elementos de Prog"
date: "`r format(Sys.time(), '%d / %m / %y')`"
author: 
  - "Antonio Paulo Steffen Neto"
  - "Ingrid Giacomeli"
  - "Jhullya da Rosa Shalders"
  - "Pedro Henrique D’Andrea"
output: html_document
bibliography: citations.bib 
---

## Introdução {#sec-01}

Este trabalho se propõe a ser a parte de conclusão do Módulo 5 da discilpina CE302 - Elementos de Programação para Estatística. Para tal, ele consiste em uma análise de um conjunto de dados disponibilizado pelos professores responsáveis e subsequente desenvolvimento de um aplicativo em Shiny para visualização dos resultados encontrados. Assim, este trabalho apresenta a parte técnica e teórica do que foi realizado pelo grupo. A parte da apresentação em um aplicativo em Shiny, por outro lado, será feita por meio de um vídeo de apresentação. Nesta introdução apresentamos, então, o conjunto de dados escolhido pelo grupo e, também, como a parte escrita do trabalho está estruturada.
Sobre a escolha do conjuntos de dados disponibilizados, o grupo optou pelo conjunto da dados chamado *Allrecipes*. Neste constam dados retirados do site [Allrecipes](https://www.allrecipes.com) sobre receitas, seus países de origem e autores, informações nutricionais, tempo de preparo, avaliações e vezes em que foram reproduzidas. Assim sendo, todas as informações a serem referenciadas no texto têm como fonte @noauthor_allrecipes_nodate.
Como definido pelas instruções dadas pela proposta de trabalho, a formatação deste segue a ordem: Introdução; Materiais e Métodos; Resultados e Discussão; Conclusão e Referências. Muitas das partes integrantes da ordem originalmente indicada, naturalmente, apresentam suas próprias subseções, assim sendo, esta **Introdução** conta com duas subseções: Contextualização e Definição do Problema e Objetivos da Análise. A parte de Materiais e Métodos, por sua vez, tem como sbdivisões: Descrição do Conjunto de Dados, Dicionário de Variáveis, Tratamento de Dados e Técnicas Estatísticas e Computacionais. Na sequência, são apresentados os Resultados e Discussão, divididos de acordo com temas de análise, com suas respectivas análises e interpretações como será, posteriormente, fácil de analisar com o aplicativo Shiny feito em conjunto com esta parte escrita. Por fim, a Conclusão e as Referências Bibliográficas não apresentam quaisquer divisões.

### Contextualização e Definição do Problema

A alimentação é a base de toda a cultura humana, o momento de comunhão em diferentes culturas e religiões. Isso estende-se desde o cômodo onde as pessoas se alimentam até a como grandes festividades por todo o globo costumam ter alguma refeição como parte central das celebrações. Mais recentemente, o destaque adquirido por grandes chefes de cosinha e por produtos culturais como reality show e séries sobre culinária são sintomas deste fenômeno. 
Mais recentemente, contudo, a relação das pessoas com a comida foi muito modificada e tornada mais complexa. Em tempos de internet, fast food e fácil acesso a ingredientes de todo o mundo, sites como o *Allrecipes* se tornaram um meio impressindível de compartilhamento de hábitos alimentares e, para pesquisadores, uma fonte preciosa de dados para entender como as pessoas se alimentam. Mas sobre o que se trata o site em questão? O *Allrecipes* consiste em um site de compartilhamento de receitas. Nele, usuários de todo o mundo podem postar suas receitas para que outras pessoas possam prová-las, acompanhar as avaliações dos outros usuários e, também, acessar receitas de outros usuários, igualmente prová-las e avaliá-las. O site *Allrecipes*, portanto, e já olhando para os dados de interesse na presente análise, nos traz dados a respeito da origem das receitas e por quem foram postadas. Além disso, também inclui as informações acerca de tempos de preparo e, também, de questões nutricionais. 
A análise de dados não estruturados provenientes da plataforma online *Allrecipes* insere-se na emergente área dGastronomia Computacional, que tem por objetivo o emprego de técnicas *data-driven* para o estudo e a análise de comidas. Esse campo busca quantificar e modelar fenômenos culinários e de consumo alimentar. Neste contexto, o volume e a variedade dos dados de receitas (incluindo as avaliações, informações nutricionais e origem geográfica) constituem um conjunto de dados de nicho, que seria ideal para a aplicação de métodos de aprendizado de máquina e modelagem estatística, caso os autores deste trabalho estivessem mais adiante no curso de Estatística.


### Objetivos da Análise

Dado o conjunto de dados escolhido, portanto, é possível fazer uma análise que cubra de maneira completa todas as variáveis a disposição, e, deste modo, explorar e documentar as dinâmicas relacionadas à popularidade de receitas publicadas online. Assim, abrem-se diversas direções de investigação, pois tanto as informações nutricionais quanto as informações acerca dos ingredientes podem ser entrelaçadas e apresentam grande complexidade. Além destas, há as informações acerca dos países de origem das receitas, suas respectivas avaliações e, também tempos de preparo, datas em que foram postadas e quantas vezes foram preparadas. 
O objetivo principal da análise, portanto, é o de entender quais as dinâmicas por trás da popularidade de receitas publicadas online na plataforma *Allrecipes*. Assim sendo, a análise é conduzida em partes e em diferentes frentes que englobam os diferentes tipos de variáveis à disposição nos conjuntos de dados disponíveis olhando para questões culturais, nutricionais, temporais e de popularidade das receitas publicadas. As divisões, como foram feitas, se apresentam da seguinte maneira: 

1. Panorama Geral: Caracterizar o perfil nutricional predominante das receitas mais populares. Isto envolverá a limpeza e harmonização das variáveis contínuas (calorias, gordura, proteína, sódio) e o uso de métricas de dispersão para comparar a centralidade desses atributos em relação ao sucesso de reprodução.
2. Países e Culinárias: O objetivo é identificar visualmente (via gráficos de dispersão) se existe uma correlação descritiva entre a complexidade do preparo e as avaliações médias.
3. As avaliações de acordo com os ingredientes: Dividir e listar os ingredientes apresentados e relacioná-los com as avaliações médias e totais dis tribuídas por cada receita. 
4. Análise Nutricional: Partindo das informações acerca de calorias, proteínas, gordura e carboidratos à disposição, serão traçados perfis a serem relacionados, também, com as avaliações das receitas.
5. As avaliações de acordo com tempos de preparo: Seguindo a mesma lógica dos itens anteriores, as diferentes métricas de tempo de preparo das receitas serão analisadas e avaliadas de acordo com a existência, ou não, de relação com as avaliações das receitas.
6. Popularidades das cozinhas e países: Relacionando tudo o que foi mostrado anteriormente, serão utilizadas medidas de dispersão para relacionar os itens anteriores com as informações de origes de cada prato e culinária.  

## Materiais e Métodos {#sec-02}

Teremos como principal material de apoio, suplemntar aos materiais da disciplina, o livro *R for data science: import, tidy, transform, visualize, and model data*, de autoria de @wickham_r_2017. Também serão utilizados para análise de observações o que é desenvolvido por @agresti_introduction_2019.
Além de ambos, também serão utilizados materiais de @trattner_estimating_2017 e @hussain_innovative_2025, que já desenvolveram análises semelhantes à que este trabalho se propõe. Além disso, também será utilizada @silva_da_costa_percepcao_2021

### Descrição do Conjunto de Dados 

Para fazer a descrição dos conjuntos de dados fornecidos, começamos carregando os dados e utilizando a função `str()` para vermos as descrições estruturais de ambos os conjuntos. 

```{r}
library(tidyverse)
library(tidytuesdayR)

# Carregamento dos dados originais
all_recipes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-16/all_recipes.csv', show_col_types = FALSE)

cuisines <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-16/cuisines.csv', show_col_types = FALSE)

str(all_recipes)
str(cuisines)
```

Isto feito, podemos dizer que o primeiro conjunto, o maior, chamado `all_recipes`, é constituído de 14.426 observações e 16 variáveis; o segundo, `cuisines`, 2.218 e 17 variáveis. O segundo conjunto tem, portanto, uma variável a mais, esta sendo a variável *country*, uma variável de caracteres que descreve o país de origem da receita. Nas outras variáveis, presentes em ambos os conjuntos de dados, há informações que descrevem as receitas postadas no site, trazendo informações dos autores, url's das receitas, ingredientes e informações nutricionais, tempos de preparo, cozimento e total, avaliações e vezes reproduzidas. Três das variáveis são do tipo caracteres, um do tipo data, e o restante valores numéricos. 
As observações vêm em uma ordem padrão de índice (definida pelo fornecedor), mas podem ser facilmente classificadas (reordenadas) de acordo com as variáveis disponíveis, como, por exemplo, ordem crescente ou decrescente de calorias, classificação média, ou tempo de preparo, etc. 

### Dicionário de Variáveis

Abaixo, temos um dicionário das variáveis existentes em ambos os conjuntos de dados:

1. `all_recipes`:

| Variável | Tipo de Dado | Descrição Completa |
|----------|--------------|--------------------|
|--------------------------------------------------------------------------------|
| `author` | Caractere/Fator | Nome do usuário que postou a receita. |
| `recipe_name` | Caractere | Nome da receita. |
| `url` | Caractere | Link da receita. |
| `ingredients` | Caractere | Base para contagem de ingredientes. |
| `prep_time` | Numérico | Tempo de preparo (minutos). |
| `cook_time` | Numérico | Tempo de cozimento (minutos). |
| `total_time` | Numérico | Tempo total (preparo + cozimento). Variável chave para Complexidade. |
| `servings` | Numérico | Número de porções que a receita produz. |
| `calories` | Numérico | Conteúdo energético (Kcal). Variável chave Nutricional. |
| `fat` | Numérico | Quantidade de gordura (g). |
| `protein` | Numérico | Quantidade de proteína (g). |
| `carbs` | Numérico | Quantidade de carboidratos (g). |
| `avg_rating` | Numérico | Avaliação média (1-5). Métrica de popularidade. |
| `total_rating` | Numérico | Número de avaliações. Métrica de popularidade. |
| `reviews` | Numérico/Inteiro | Número de avaliações recebidas. |
| `date_published` | Data | Data em que a receita foi publicada no site. |

2. `cuisines`:


| Variável | Tipo de Dado | Descrição Completa e Relevância |
| ---------|------------------------- | ---------------- | |---------------------------------------------------------------------------------------------|
| `author` | Caractere/Fator | Nome do usuário. |
| `name` | Caractere | Nome da receita. |
| `url` | Caractere | Link da receita. |
| `ingredients` | Caractere | Usado para derivar a contagem de ingredientes. |
| `prep_time` | Numérico | Tempo de preparo (minutos). |
| `cook_time` | Numérico | Tempo de cozimento (minutos). |
| `total_time` | Numérico | Tempo total (preparo + cozimento). |
| `servings` | Numérico | Número de porções. |
| `calories` | Numérico | Conteúdo energético (Kcal). |
| `fat` | Numérico | Quantidade de gordura (g). |
| `protein` | Numérico | Quantidade de proteína (g). |
| `carbs` | Numérico | Quantidade de carboidratos (g). |
| `avg_rating` | Numérico | Avaliação média (1-5). Métrica de popularidade. |
| `total_rating` | Numérico | Número de avaliações. Métrica de popularidade. |
| `reviews` | Numérico/Inteiro | Número de avaliações recebidas. |
| `date_published` | Data | Data de publicação. |
| `country` | Caractere/Fator | **País de origem.** Variável chave para análise geocultural (vem do `cuisines`). |

### Tratamento dos Dados 

1. Fusão de Conjuntos de Dados: Inicialmente, o dataset principal (all_recipes) foi unido ao dataset auxiliar (cuisines) utilizando-se a variável de chave primária (recipe_id ou equivalente), resultando em um único data frame analítico.

2. Tratamento de Valores Faltantes (NA): Verificou-se a presença de valores NA (Not Available) nas variáveis nutricionais. Foi adotada a estratégia de imputação por mediana para os NAs em variáveis contínuas, como calorias, onde a ausência de informação era considerada Missing At Random (MAR), para maximizar o número de observações úteis. Para a variável country, os NAs foram categorizados como "Não Especificado".

3.  Padronização e Normalização: Variáveis com alta variabilidade, como reproduções, foram consideradas para transformação logarítmica $(\log(X+1))$ para aproximar suas distribuições de uma normalidade e mitigar a influência de outliers extremos no ajuste dos modelos de regressão.

4. Codificação de Variáveis Categóricas: A variável country foi convertida para o tipo fator (factor) para uso em modelos estatísticos, sendo implementado o esquema de codificação dummy (variáveis binárias) para as análises de regressão.

### Técnicas Estatísticas e Computacionais

Detalhando os métodos utilizados para o processamento, análise e visualização dos dados, podemos começar apontando o fato de que o estudo foi conduzido utilizando a linguagem R e o ecossistema de pacotes tidyverse (incluindo dplyr e ggplot2). As etapas iniciais de preparação de dados incluíram algumas tarefas distintas. Dentre elas pode-se apontar duas direções principais: a de padronização geográfica e a de derivação das variáveis. Ambas serão definidas nos próximos parágrafos.
Primeiramente, a padronização geográfica. Esta consistiu na padronizaçõ de países e regiões para categorias consistentes (por exemplo, o agrupamento de sub-culinárias regionais dos EUA sob o rótulo "US American"). Posteriormente, as culinárias foram agrupadas em seis categorias continentais (Ásia, Europa, América do Norte, América do Sul, África e Oceania) para análises macro.
Em segundo lugar, e menos para a simples categorização de variáveis e observações, foram criadas duas variáveis-chave para medir a complexidade e o esforço. A primeira a Quantidade de Ingredientes ($\hat{I}$): Calculada pela contagem de vírgulas nos *strings* da lista de ingredientes, adicionada de um, como *proxy* da complexidade. A segunda, o Tempo Total de Preparo ($\hat{T}$): Variável `total_time` convertida para formato numérico (minutos), representando o esforço temporal. 

### Métodos Estatísticos e Modelagem

Olhando para as anáises estatísticas, elas se concentraram em quatro vertentes principais. A primeira é dedicada à estatística descritiva e ao ranqueamento de observações. Foram reaizados cálculo de média de avaliação ($\bar{R}_{g}$), desvio padrão ($s_R$) e contagem de receitas ($N$) por país/região. Após isto, foi aplicado um filtro mínimo de $N \geq 10$ receitas para garantir a estabilidade das médias de avaliação. A segunda vertente diz respeito à análise das quantidades de ingredientes e dos tempos de preparo, foi empregada a análise de correlação, utilizando o Coeficiente de Correlação de Pearson ($r$) para quantificar a relação linear entre as variáveis de complexidade/esforço e a qualidade percebida (média de avaliação). 
Além delas, a análise bivariada foi empregada para demonstrar a relação entre Popularidade e Qualidade. Um Gráfico de Bolhas foi escolhido para visualizar simultaneamente a média de avaliações por receita (Popularidade), a média de nota (Qualidade) e o número de receitas (Tamanho da Bolha) por culinária. Por fim, foi examinada a série temporal do Total de Avaliações no Ano de Publicação para rastrear a evolução da popularidade das culinárias ranqueadas ao longo do período de dados.

### Visualização dos Dados 

A visualização de dados é parte central para a interpretação dos resultados, sendo o pacote *ggplot2* utilizado para a criação de todos os gráficos estatísticos, como o ranking de culinárias, os gráficos de dispersão e o Gráfico de Bolhas. Os pacotes *gridExtra* e *grid* foram cruciais para a renderização e o arranjo das tabelas comparativas e seus títulos (*tableGrob*, *grid.arrange*, *textGrob*), garantindo a apresentação organizada dos sumários de dados.

## Resultados e discussão {#sec-03}

Os resultados atingidos em cada parte do trabalho vão em diferentes direções. Inicialmente, a análise das médias de avaliação revelou um ranking onde culinárias com alta qualidade percebida (alta $\bar{R}_{g}$) frequentemente exibiam um baixo desvio padrão ($s_R$), sugerindo consistência na excelência. O agrupamento continental permitiu observar tendências regionais na satisfação do usuário. A Figura 1 apresenta o ranking das top 15 culinárias, destacando a média de avaliação com barras de erro representando o desvio padrão. Após análise, A variação na qualidade entre continentes sugere que a tradição e a identidade gastronômica específica de uma região exercem maior influência na satisfação do que fatores universais de preparação.

### Relação entre Ingredientes e Avaliações

A análise dos dados revela uma correlação positiva, porém extremamente fraca, entre a quantidade de ingredientes e a avaliação final das receitas em ambos os bancos de dados. A Figura 1 confirma que, com coeficientes de 0,1 para "cuisines" e 0,08 para "all_recipes", conclui-se que a complexidade do prato (medida pelo número de itens) praticamente não influencia a nota atribuída pelos usuários; ou seja, embora exista uma tendência matemática muito sutil de aumento na avaliação conforme o número de ingredientes cresce, na prática essa relação é desprezível, indicando que receitas simples têm tanta chance de serem bem avaliadas quanto as mais complexas.

```{r}
#ingredientes x nota
ingredientes_nota = function(dados, nome_do_banco) {
  
  #coluna de quantidade de ingredientes
  dados_processados = dados %>%
    filter(!is.na(avg_rating), !is.na(ingredients)) %>%
    mutate(
      qtd_ingredientes = str_count(ingredients, ",") + 1,
      avg_rating = as.numeric(avg_rating)
    )
  
  # Correlação
  correlacao = cor(dados_processados$qtd_ingredientes, 
                   dados_processados$avg_rating, 
                   use = "complete.obs")
  
  cat(paste0("\nAnálise para: ", nome_do_banco, "\n"))
  cat(paste("Correlação:", round(correlacao, 3), "\n"))
  
  # Gráfico
  grafico = ggplot(dados_processados, aes(x = qtd_ingredientes, y = avg_rating)) +
    geom_jitter(alpha = 0.2, color = "steelblue") + 
    geom_smooth(method = "lm", color = "darkred") + 
    labs(
      title = paste("Ingredientes vs Nota:", nome_do_banco),
      subtitle = paste("Correlação de Pearson:", round(correlacao, 3)),
      x = "Quantidade de Ingredientes",
      y = "Nota Média"
    ) +
    theme_minimal()
  
  print(grafico)
}

ingredientes_nota(cuisines, "Banco Cuisines")
ingredientes_nota(all_recipes, "Banco All Recipes")
```


### Relação entre Tempo de Preparo e Avaliações

Ao analisar a influência do tempo total de preparo (total_time) sobre a avaliação das receitas (avg_rating), com uma visualização (Figura 2) abrangendo até 480 minutos (8 horas), observou-se uma ausência de correlação significativa em ambos os bancos de dados. Com coeficientes irrelevantes de 0,047 para o banco 'cuisines' e 0,008 para 'all_recipes', os dados demonstram estatisticamente que a duração da receita não é um fator determinante para a sua nota final. Isso sugere que a satisfação dos usuários independe do tempo investido na cozinha, com pratos rápidos recebendo avaliações tão altas quanto preparos de longa duração.

```{r}
tempo_nota <- function(dados, nome_do_banco) {
  
  # 1. Limpeza e Tratamento
  dados_processados <- dados %>%
    mutate(
      avg_rating = as.numeric(avg_rating),
      total_time = as.numeric(total_time)
    ) %>%
    # Removemos linhas vazias ou com tempo zerado/negativo
    filter(!is.na(avg_rating), !is.na(total_time), total_time > 0)
  
  # 2. Cálculo da Correlação (considerando todos os dados)
  correlacao <- cor(dados_processados$total_time, 
                    dados_processados$avg_rating, 
                    use = "complete.obs")
  
  cat(paste0("\n--- Análise: ", nome_do_banco, " ---\n"))
  cat(paste("Correlação geral:", round(correlacao, 3), "\n"))
  
  # 3. Gráfico de Dispersão
  # OBS: Fiz um filtro NO GRÁFICO para mostrar apenas receitas até 480 min (8h)
  # Se não fizer isso, uma única receita de 24h esmaga o gráfico todo.
  grafico <- ggplot(dados_processados %>% filter(total_time <= 480), 
                    aes(x = total_time, y = avg_rating)) +
    
    geom_jitter(alpha = 0.2, color = "forestgreen") + # Pontos verdes
    geom_smooth(method = "lm", color = "black") +    # Linha de tendência preta
    
    labs(
      title = paste("Tempo de Preparo vs Nota:", nome_do_banco),
      subtitle = paste("Correlação de Pearson:", round(correlacao, 3)),
      x = "Tempo de Preparo (minutos)",
      y = "Nota (0-5)"
    ) +
    theme_minimal()
  
  print(grafico)
}

# Executando para os dois bancos
tempo_nota(cuisines, "Banco Cuisines")
tempo_nota(all_recipes, "Banco All Recipes")
```


### Relação entre 

Ao olharmos para a análise bivariada, por fim, estabeleceu-se uma clara diferenciação entre as culinárias mais populares e as de maior qualidade. O Gráfico de Bolhas (Figura 3) ilustra que a alta Popularidade, medida pela média de avaliações por receita, nem sempre se traduz em alta Qualidade, medida pela média de nota. Esta divergência indica que a popularidade pode ser impulsionada por fatores de acessibilidade ou tendência, desvinculando-se da excelência na avaliação. A análise de tendência temporal complementou este achado ao mostrar que o Total de Avaliações no Ano é dinâmico, refletindo o ciclo de vida e a ascensão do interesse em certas culinárias ao longo do tempo.


### Análises e Interpretações

As interpretações centrais do estudo convergem na primazia da qualidade intrínseca sobre o esforço extrínseco. A correlação nula entre o tempo e os ingredientes versus a nota média implica que os usuários valorizam o resultado final da receita sobre o custo de preparo, sugerindo que o foco na otimização do sabor e na clareza da instrução é mais determinante do que a complexidade.

Em contraste, a diferença significativa nas médias de avaliação entre culinárias continentais sugere que as tradições gastronômicas consolidadas (origem) são um forte preditor da qualidade percebida.

A distinção entre popularidade e qualidade, por sua vez, reforça a necessidade de se utilizar métricas ponderadas ao ranquear culinárias. Um alto volume de interesse (popularidade) pode não ser um substituto direto para a excelência percebida (alta média de nota), e a dinâmica temporal do conteúdo é um fator chave para o engajamento na plataforma.

## Conclusão {#sec-04}

O presente estudo demonstrou, através de análises estatísticas rigorosas, que o esforço e a complexidade de uma receita não são fatores determinantes para a sua avaliação final pelos usuários, com o coeficiente de Pearson próximo de zero estabelecendo a independência entre estas variáveis e a satisfação. Em contrapartida, a origem geográfica da culinária influencia a avaliação média, sugerindo a alta relevância da tradição. O estudo também enfatizou a distinção analítica entre popularidade e qualidade, alertando contra a utilização de métricas de volume como substitutas para a percepção de excelência. Em síntese, a satisfação do usuário é primariamente guiada por fatores intrínsecos de sabor e qualidade de execução, e não por custos de tempo ou esforço.

## Referências Bibliográficas {#sec-05}



